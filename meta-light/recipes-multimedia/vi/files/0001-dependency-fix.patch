From c20ab7d4c6379dea635f63d1fee5f1a4e27d172c Mon Sep 17 00:00:00 2001
From: "nanli.yd" <nanli.yd@linux.alibaba.com>
Date: Tue, 8 Nov 2022 13:29:37 +0800
Subject: [PATCH] dependency fix

---
 drivers/CMakeLists.txt         | 9 +++++----
 drivers/GC02M1B/CMakeLists.txt | 3 ++-
 drivers/GC5035/CMakeLists.txt  | 3 ++-
 drivers/IMX219/CMakeLists.txt  | 3 ++-
 drivers/IMX334/CMakeLists.txt  | 3 ++-
 drivers/SC132GS/CMakeLists.txt | 3 ++-
 drivers/SC2310/CMakeLists.txt  | 3 ++-
 7 files changed, 17 insertions(+), 10 deletions(-)

diff --git a/drivers/CMakeLists.txt b/drivers/CMakeLists.txt
index 1108d64..ae01f07 100644
--- a/drivers/CMakeLists.txt
+++ b/drivers/CMakeLists.txt
@@ -72,13 +72,14 @@ add_definitions(-DMRV_STITCHING_VERSION=2)
 
 add_compile_options(-Werror=implicit-function-declaration)
 
+set(DEPEND_LIBS
+    isi
+    hal
+)
+
 add_subdirectory(IMX219)
 add_subdirectory(SC2310)
 add_subdirectory(SC132GS)
 add_subdirectory(GC5035)
 add_subdirectory(GC02M1B)
 add_subdirectory(IMX334)
-
-link_libraries(${PROJECT_NAME} isi )
-
-#target_link_libraries()
diff --git a/drivers/GC02M1B/CMakeLists.txt b/drivers/GC02M1B/CMakeLists.txt
index aed4fc8..b2fd362 100644
--- a/drivers/GC02M1B/CMakeLists.txt
+++ b/drivers/GC02M1B/CMakeLists.txt
@@ -28,7 +28,8 @@ add_custom_target(${module}.drv
                   DEPENDS ${module}
                   COMMENT "Copying ${module} driver module"
                   )
-    
+target_link_libraries(${module} ${DEPEND_LIBS} )
+add_dependencies(${module} ${DEPEND_LIBS})    
 #install(FILES       ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/lib/lib${module}.so.${${module}_INTERFACE_CURRENT}
 #                  DESTINATION ${CMAKE_INSTALL_PREFIX}/bin
 #                  RENAME      ${module}.drv
diff --git a/drivers/GC5035/CMakeLists.txt b/drivers/GC5035/CMakeLists.txt
index 8e7b707..f330ac2 100644
--- a/drivers/GC5035/CMakeLists.txt
+++ b/drivers/GC5035/CMakeLists.txt
@@ -28,7 +28,8 @@ add_custom_target(${module}.drv
                   DEPENDS ${module}
                   COMMENT "Copying ${module} driver module"
                   )
-    
+target_link_libraries(${module} ${DEPEND_LIBS} )
+add_dependencies(${module} ${DEPEND_LIBS})    
 #install(FILES       ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/lib/lib${module}.so.${${module}_INTERFACE_CURRENT}
 #                  DESTINATION ${CMAKE_INSTALL_PREFIX}/bin
 #                  RENAME      ${module}.drv
diff --git a/drivers/IMX219/CMakeLists.txt b/drivers/IMX219/CMakeLists.txt
index 10d0942..44b6c3d 100644
--- a/drivers/IMX219/CMakeLists.txt
+++ b/drivers/IMX219/CMakeLists.txt
@@ -28,7 +28,8 @@ add_custom_target(${module}.drv
                   DEPENDS ${module}
                   COMMENT "Copying ${module} driver module"
                   )
-    
+target_link_libraries(${module} ${DEPEND_LIBS} )
+add_dependencies(${module} ${DEPEND_LIBS})
 #install(FILES       ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/lib/lib${module}.so.${${module}_INTERFACE_CURRENT}
 #                  DESTINATION ${CMAKE_INSTALL_PREFIX}/bin
 #                  RENAME      ${module}.drv
diff --git a/drivers/IMX334/CMakeLists.txt b/drivers/IMX334/CMakeLists.txt
index 3f7644b..6b3ec80 100644
--- a/drivers/IMX334/CMakeLists.txt
+++ b/drivers/IMX334/CMakeLists.txt
@@ -28,7 +28,8 @@ add_custom_target(${module}.drv
                   DEPENDS ${module}
                   COMMENT "Copying ${module} driver module"
                   )
-    
+target_link_libraries(${module} ${DEPEND_LIBS} )
+add_dependencies(${module} ${DEPEND_LIBS})    
 #install(FILES       ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/lib/lib${module}.so.${${module}_INTERFACE_CURRENT}
 #                  DESTINATION ${CMAKE_INSTALL_PREFIX}/bin
 #                  RENAME      ${module}.drv
diff --git a/drivers/SC132GS/CMakeLists.txt b/drivers/SC132GS/CMakeLists.txt
index ffe843e..955e167 100644
--- a/drivers/SC132GS/CMakeLists.txt
+++ b/drivers/SC132GS/CMakeLists.txt
@@ -28,7 +28,8 @@ add_custom_target(${module}.drv
                   DEPENDS ${module}
                   COMMENT "Copying ${module} driver module"
                   )
-    
+target_link_libraries(${module} ${DEPEND_LIBS} )
+add_dependencies(${module} ${DEPEND_LIBS})    
 #install(FILES       ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/lib/lib${module}.so.${${module}_INTERFACE_CURRENT}
 #                  DESTINATION ${CMAKE_INSTALL_PREFIX}/bin
 #                  RENAME      ${module}.drv
diff --git a/drivers/SC2310/CMakeLists.txt b/drivers/SC2310/CMakeLists.txt
index ae10818..e293ac4 100644
--- a/drivers/SC2310/CMakeLists.txt
+++ b/drivers/SC2310/CMakeLists.txt
@@ -28,7 +28,8 @@ add_custom_target(${module}.drv
                   DEPENDS ${module}
                   COMMENT "Copying ${module} driver module"
                   )
-    
+target_link_libraries(${module} ${DEPEND_LIBS} )
+add_dependencies(${module} ${DEPEND_LIBS})
 #install(FILES       ${LIB_ROOT}/${CMAKE_BUILD_TYPE}/lib/lib${module}.so.${${module}_INTERFACE_CURRENT}
 #                  DESTINATION ${CMAKE_INSTALL_PREFIX}/bin
 #                  RENAME      ${module}.drv
-- 
2.17.1

